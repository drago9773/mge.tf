<% const region = regions.find(reg => reg.id === team.regionId); %> 
<% const division = divisions.find(div => div.id === team.divisionId); %>

<div class="text-black flex flex-col mx-auto max-w-5xl w-3/5 bg-white shadow-md rounded-lg p-6 gap-4 mt-2">
  <div class="flex flex-col justify-center align-middle items-center">
    <h1 class="text-3xl font-bold m-2">
      <%= team.name %> 
    </h1>
    <img src="<%= team.team_avatar %>" alt="Team Avatar" class="w-24 h-24 rounded-full">
    <p class="text-xl">Division: <%= division ? division.name : ' ' %></p>
    <p class="text-xl">Region: <%= region ? region.name : ' ' %></p>
    <p class="text-xl">Record: <%= team.record %></p>
    <p class="text-xl">Status: <%= team.status === 0 ? 'Inactive' : 'Active' %></p>
    <p class="text-sm text-gray-500">Created at: <%= new Date(team.created_at * 1000).toLocaleDateString() %></p>
  </div>

  <div class="flex flex-col gap-2 mt-4">
    <h2 class="text-2xl font-bold">Matches</h2>

    <% 
      const matchesBySeason = matches.reduce((acc, match) => {
        const season = match.seasonNo;
        if (!acc[season]) {
          acc[season] = [];
        }
        acc[season].push(match);
        return acc;
      }, {});
    %>

    <% for (const season in matchesBySeason) { %>
      <h3 class="text-xl font-bold mt-4">Season <%= season %></h3>

      <% 
        // Sort the matches by week number
        const seasonMatches = matchesBySeason[season].sort((a, b) => a.weekNo - b.weekNo);
      %>

      <table class="min-w-full bg-white shadow-md rounded-lg overflow-hidden mb-4">
        <thead>
          <tr class="w-full bg-gray-200 text-gray-700 text-left text-sm uppercase">
            <th class="px-4 py-2">Week No</th>
            <th class="px-4 py-2">Match ID</th>
            <th class="px-4 py-2">Team 1</th>
            <th class="px-4 py-2">Score</th>
            <th class="px-4 py-2">Team 2</th>
            <th class="px-4 py-2">Created At</th>
          </tr>
        </thead>
        <tbody>
          <% seasonMatches.forEach(match => { %>
            <tr onclick="window.location.href='/match_page/<%= match.id %>'" style="cursor: pointer;">
              <td class="border px-4"><%= match.weekNo %></td>
              <td class="border px-4"><%= match.id %></td>

              <% const homeTeam = teams.find(t => t.id === match.homeTeamId); %>
              <% const awayTeam = teams.find(t => t.id === match.awayTeamId); %>

              <% if (team.id === match.homeTeamId) { %>
                <td class="border px-4"><%= homeTeam ? homeTeam.name : ' ' %></td>
                <td class="border px-4">
                  <%= match.winnerId === match.homeTeamId 
                    ? `${match.winnerScore} - ${match.loserScore}` 
                    : `${match.loserScore} - ${match.winnerScore}` 
                  %>
                </td>
                <td class="border px-4"><%= awayTeam ? awayTeam.name : ' ' %></td>
              <% } else { %>
                <td class="border px-4"><%= awayTeam ? awayTeam.name : ' ' %></td>
                <td class="border px-4">
                  <%= match.winnerId === match.awayTeamId 
                    ? `${match.winnerScore} - ${match.loserScore}` 
                    : `${match.loserScore} - ${match.winnerScore}` 
                  %>
                </td>
                <td class="border px-4"><%= homeTeam ? homeTeam.name : ' ' %></td>
              <% } %>

              <td class="border px-4"><%= new Date(match.created_at * 1000).toLocaleDateString() %></td>
            </tr>
          <% }) %>
        </tbody>        
      </table>
      <% if (seasonMatches.length === 0) { %>
        <p class="text-gray-500">No matches found for this season.</p>
      <% } %>
    <% } %>
  </div>
</div>
