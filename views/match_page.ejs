<% const currentPlayerSteamId = session?.user; %>
<% if ((currentPlayerSteamId && isTeamOwner && (match.winnerId == null)) || isAdmin) { %>
    <h1 class="mx-auto text-black font-bold py-2 px-4 rounded bg-yellow-500">
        You can submit match score
    </h1>
<% } %>
<div class="w-full bg-black bg-opacity-50 backdrop-blur-lg h-full flex flex-col justify-center align-middle">
    <div class="container mx-auto p-4 flex flex-col align-middle justify-center w-full items-center">
        <h1 class="text-3xl font-bold mb-4 text-white">Match Details for Match ID: <%= match.id %></h1>

        <h2 class="text-2xl mb-2 text-white">Games:</h2>
        <form action="/match_page/<%= match.id %>/update-scores" method="POST" class="space-y-4">

            <table class="bg-gray-700 divide-y divide-gray-700 w-full mx-auto table-fixed mb-6">
                <thead>
                    <tr>
                        <th class="px-4 py-2 text-left text-xs font-large uppercase tracking-wider">Game No</th>
                        <th onclick="window.location.href='/team_page/<%= teams.find(team => team.id === match.homeTeamId).id %>'" style="cursor: pointer;" class="px-4 py-2 text-left text-xs font-large uppercase tracking-wider"><%= teams.find(team => team.id === match.homeTeamId).name %></th>
                        <th onclick="window.location.href='/team_page/<%= teams.find(team => team.id === match.awayTeamId).id %>'" style="cursor: pointer;" class="px-4 py-2 text-left text-xs font-large uppercase tracking-wider"><%= teams.find(team => team.id === match.awayTeamId).name %></th>
                        <th class="px-4 py-2 text-left text-xs font-large uppercase tracking-wider">Arena</th>
                    </tr>
                </thead>
                <tbody class="bg-gray-800 divide-y divide-gray-700 rounded-lg">
                    <% for (let i = 0; i < match.boSeries; i++) { %>
                        <% const game = games.find(g => g.matchId === match.id && g.gameNum === i + 1); %>
                        <tr>
                            <td class="border px-4 py-2"><%= i + 1 %></td>
                            <% if (isAdmin || (isTeamOwner && match.winnerId == null)) { %>
                                <td class="border px-4 py-2">
                                    <input 
                                        required 
                                        id="homeTeamScore-<%= i %>" 
                                        type="number" 
                                        name="homeTeamScore-<%= i %>" 
                                        value="<%= game ? game.homeTeamScore : '' %>" 
                                        class="dark-input">
                                </td>
                                <td class="border px-4 py-2">
                                    <input 
                                        required 
                                        id="awayTeamScore-<%= i %>" 
                                        type="number" 
                                        name="awayTeamScore-<%= i %>" 
                                        value="<%= game ? game.awayTeamScore : '' %>" 
                                        class="dark-input">
                                </td>
                            <% } else { %>
                                <td class="border px-4 py-2"><%= game ? game.homeTeamScore : '-' %></td>
                                <td class="border px-4 py-2"><%= game ? game.awayTeamScore : '-' %></td>
                            <% } %>
                            <td class="border px-4 py-2">
                                <% const arena = game ? arenas.find(arena => arena.id === game.arenaId) : null; %>
                                <%= arena ? arena.name : 'Unknown Arena' %>
                            </td>
                        </tr>
                    <% } %>
                </tbody>
            </table>

            <% if (isTeamOwner || isAdmin) { %>
                <input type="hidden" name="isTeamOwner" value="<%= isTeamOwner %>">
                <button type="submit" class="bg-yellow-500 text-black font-bold py-2 px-4 rounded">Submit Scores</button>
            <% } %>
        </form>
    </div>
</div>

<style>
    .score-high {
        background-color: rgba(43, 132, 43, 0.7); 
        color: black;
    }

    .score-low {
        color: black;
    }

    .dark-input {
        background-color: #333; 
        color: white; 
        border: 1px solid #555;
        padding: 4px;
        border-radius: 4px;
    }
</style>
